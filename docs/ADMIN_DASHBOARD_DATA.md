# üìä –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

## –î–∞—à–±–æ—Ä–¥ (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

–î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL —á–µ—Ä–µ–∑ Prisma ORM:

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

1. **–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (`totalUsers`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.user.count()`
   - –¢–∞–±–ª–∏—Ü–∞: `User`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **–í—Å–µ–≥–æ —Ä—ã–Ω–∫–æ–≤** (`totalMarkets`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.market.count()`
   - –¢–∞–±–ª–∏—Ü–∞: `Market`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤

3. **–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤** (`activeMarkets`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.market.count({ where: { status: 'active' } })`
   - –¢–∞–±–ª–∏—Ü–∞: `Market` (—Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É `active`)
   - –û–ø–∏—Å–∞–Ω–∏–µ: –†—ã–Ω–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏

4. **–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫** (`totalBets`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.bet.count()`
   - –¢–∞–±–ª–∏—Ü–∞: `Bet`
   - –û–ø–∏—Å–∞–Ω–∏–µ: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫

5. **–û–±—â–∏–π –æ–±—ä–µ–º** (`totalVolume`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.transaction.aggregate({ where: { type: 'deposit', status: 'completed' }, _sum: { amount: true } })`
   - –¢–∞–±–ª–∏—Ü–∞: `Transaction` (—Å—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤)
   - –û–ø–∏—Å–∞–Ω–∏–µ: –û–±—â–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –≤ TON

6. **–í—ã–ø–ª–∞—Ç** (`totalPayouts`)
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `prisma.payout.count({ where: { status: 'completed' } })`
   - –¢–∞–±–ª–∏—Ü–∞: `Payout` (—Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É `completed`)
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç

### –ü–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω—É–ª–µ–≤—ã–º–∏?

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è** - –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—ã–Ω–∫–æ–≤, —Å—Ç–∞–≤–æ–∫
- **–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `pending`
- **–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç** - –≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã –≤ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö

### –ö–∞–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏?

1. **–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –ß–µ—Ä–µ–∑ Telegram Mini App (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ)
   - –ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏")

2. **–°–æ–∑–¥–∞—Ç—å —Ä—ã–Ω–∫–∏:**
   - –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏: "–†—ã–Ω–∫–∏" ‚Üí "–°–æ–∑–¥–∞—Ç—å —Ä—ã–Ω–æ–∫"

3. **–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã:**
   - –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" ‚Üí "–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å" ‚Üí "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ"

4. **–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏:**
   - –ß–µ—Ä–µ–∑ Telegram Mini App –∏–ª–∏ API

---

## –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

–î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `AnalyticsEvent`:

- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞** - –∏–∑ –ø–æ–ª—è `trafficSourceId`
- **–í—Ä–µ–º—è —Å—Ç–∞–≤–æ–∫** - –∏–∑ `createdAt` —Å–æ–±—ã—Ç–∏–π —Ç–∏–ø–∞ `bet_placed`
- **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä—ã–Ω–∫–∏** - –∏–∑ `marketId` —Å–æ–±—ã—Ç–∏–π
- **–ì–ª—É–±–∏–Ω–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** - –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `LiquidityPool`
- **–ö–æ–≥–æ—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **DAU/MAU** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –¥–Ω—è–º/–º–µ—Å—è—Ü–∞–º

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"** –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
2. –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ù–∞–∂–º–∏—Ç–µ **"–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **"–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ"**
5. –£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É –∏ –≤–∞–ª—é—Ç—É (TON –∏–ª–∏ USDT)
6. –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
7. –ù–∞–∂–º–∏—Ç–µ **"–ü—Ä–∏–º–µ–Ω–∏—Ç—å"**

### –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é, –Ω–æ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **"–°–ø–∏—Å–∞–Ω–∏–µ"**

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞?

1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `Balance`
2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `Transaction` —Å —Ç–∏–ø–æ–º `admin_adjustment`
3. **–ê—É–¥–∏—Ç-–ª–æ–≥** - –∑–∞–ø–∏—Å—å –≤ `AdminAuditLog` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `admin` –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å—ã
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∞—É–¥–∏—Ç-–ª–æ–≥
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏

---

## –§–æ—Ä–º–∞—Ç –¥–∞—Ç –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD`, –∞ backend –æ–∂–∏–¥–∞–µ—Ç ISO 8601.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä –≤ `AnalyticsQueryDto`, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç:
- `2025-12-24` ‚Üí `2025-12-24T00:00:00.000Z` (–¥–ª—è startDate)
- `2025-12-24` ‚Üí `2025-12-24T23:59:59.999Z` (–¥–ª—è endDate)

–¢–µ–ø–µ—Ä—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫!

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –º–æ–∂–Ω–æ:

1. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   ```sql
   INSERT INTO "User" (id, "telegramId", username, "firstName", "isActive", "isVerified")
   VALUES ('test-user-id', '123456789', 'testuser', 'Test', true, true);
   ```

2. **–°–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª–µ–∫:**
   ```sql
   INSERT INTO "Wallet" (id, "userId", type, "isActive")
   VALUES ('test-wallet-id', 'test-user-id', 'ton', true);
   ```

3. **–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
   - –ù–∞–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ù–∞–∂–º–∏—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
   - –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—É—é —Å—É–º–º—É

---

## API Endpoints

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞—à–±–æ—Ä–¥–∞
```
GET /api/admin/dashboard
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞–ª–∞–Ω—Å–∞–º–∏
```
GET /api/admin/users/balances?page=1&limit=20&search=username
```

### –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST /api/admin/balance/adjust
Body: {
  userId: string,
  walletId: string,
  type: 'credit' | 'debit',
  amount: number,
  currency: string,
  description?: string
}
```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:**
   ```bash
   cd apps/backend
   npm run prisma:generate
   npm run prisma:migrate
   npm run prisma:seed
   ```

2. **–î–ª—è —Ä–∞–±–æ—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω—É–∂–Ω—ã —Å–æ–±—ã—Ç–∏—è:**
   - –°–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ API: `POST /api/analytics/track`

3. **–ë–∞–ª–∞–Ω—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `Balance`
   - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∞ –Ω–µ—Ç, –æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –Ω—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

